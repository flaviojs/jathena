//================================================
//prtg_cas01 Abrai Kafra test script by Kalen
//================================================
//とり?えず、TEST作成('A`)
//prtg_cas01.txtのアブ?イはコ??トアウトですよ〜
prtg_cas01.gat,112,181,0	script	アブ?イ	55,{
	set @GIDp1,getcastledata("prtg_cas01.gat",1);
	mes "Debug :@GIDp1="+@GIDp1;
	mes "       getcharid(2)="+getcharid(2);
	mes "       strcharinfo(0)="+strcharinfo(0);
	mes "       getcharid(0)="+getcharid(0);
	mes "       getguildmasterid(@GIDp1)="+getguildmasterid(@GIDp1);
	next;
	if (@GIDp1 == 0) goto LStart;
	if (getcharid(2) != @GIDp1) goto LStart2;
	if (getcharid(0) == getguildmasterid(@GIDp1)) goto LStart3;
	goto LStart2;

// ------- アジト未占領 ----------------------------------
LStart:
	mes "[執?アブ?イ]";
	mes "?は、主人を待っています…、";
	mes "勇敢なプ?イ?ー！?なたを待ってますよ！！";
	close;
// -------- マスターじゃない ------------------------------
LStart2:
	mes "[執?アブ?イ]";
	mes "?なた方がいくら脅そうとも、";
	mes "?は?のマスターで?る";
	mes "^ff0000" + getguildmaster(@GIDp1) + "^000000様にのみ";
	mes "お仕えする身で?る。";
	mes "ガーディア?たちはどこか！";
	mes "?くこの無礼な者?を追放しなさい！";
	close;
// -------- 以下マスター? ---------------------------------
LStart3:
	mes "[執?アブ?イ]";
	mes "おかえりなさいませ、^ff0000 "+ getguildmaster(@GIDp1) + " ^000000 様";
	mes "何なりと申し付けくださいませ";
	next;
	menu "砦の状態を表示",L1,"商業発展に??",L2,"砦の防衛に??",L3,"ガーディア?設置",L4,"カプ?との契約 / 解雇",L5,"マスターの?屋に入る",L6,"アジトを放棄する",L7;
//-----------------------------------------------------------
//================================================
//Phase 1:ギ?ドのプ?パティ(未調整)
//================================================
L1:
	mes "[執?アブ?イ]";
	mes "ギ?ド基礎情報:";
	mes " ";
	mes "^0000ff現在の通商??は" + GetCastleData("prtg_cas01.gat",2) + "です。";
	mes "- 最後の期間に" + GetCastleData("prtg_cas01.gat",4) + "回??しました。";
	mes "現在の防御??は" + GetCastleData("prtg_cas01.gat",3) + "です。";
	mes "- 最後の期間に" + GetCastleData("prtg_cas01.gat",5) + "回??しました。^000000";
	mes " ";
	mes "以上です。";
	close;
//================================================
//Phase 2:商業への??(未調整)
//================================================
L2:
	mes "[執?アブ?イ]";
	mes "?なたが通商??を?やせば、";
	mes "ギ?ドの生産力はより多くの品物を";
	mes "生産するために?加します。";
	mes " ";
	mes "一日に一回、一期間に二回まで??できます。";
	next;
	set @TriggerE,GetCastleData("prtg_cas01.gat",4);
	set @Economy,GetCastleData("prtg_cas01.gat",2);
	if(@TriggerE < 2) goto L2_1;
		mes "[執?アブ?イ]";
		mes "^ff0000ギ?ド??は現在100%です。";
		mes "今は??する必要が?りません。^000000";
	 	close;
L2_1:
	mes "[執?アブ?イ]";
	mes "^ff0000?なたは、一期間に2回まで??することが出?ます。^000000";
	mes " ";
	mes "必要な??量は^ff0000 10,000 ^000000Zenyです";
	mes "??しますか？";
	next;
	menu "??する",L2_1_1,"??しない",-;
		mes "[執?アブ?イ]";
		mes "了解しました。";
		mes "急ぐ必要は無いですからね〜";
		close;
	L2_1_1:
		if(Zeny < 10000) goto L2_error;
		set Zeny,Zeny-10000;
		SetCastleData "prtg_cas01.gat",4,@TriggerE+1;
		SetCastleData "prtg_cas01.gat",2,@Economy+10000;
		mes "[執?アブ?イ]";
		mes "??に成功しました。";
		close;
L2_error:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "??に必要なお金が?りません。";
	mes "??を取り消しました。";
	close;
//================================================
//Phase 3:ディフェ?スへの??(現状実?無?か？)
//================================================
L3:
//var defenseOK = AgitGet AGIT_D_FUNDING_OK  
	mes "[執?アブ?イ]";
	mes "?なたが防御??し、";
	mes "ガーディア?達のHPを?加させれば、";
	mes "敵が攻めてきたときに大いに?けになるでしょう";
	mes " ";
	mes "一日に一回、一期間に二回まで??できます。";
	next;
	set @TriggerD,GetCastleData("prtg_cas01.gat",5);
	set @Deffence,GetCastleData("prtg_cas01.gat",3);
	if(@TriggerD < 2) goto L3_1;
		mes "[執?アブ?イ]";
		mes "^ff0000ギ?ド??は現在100%です。";
		mes "今は??する必要が?りません。^000000";
	 	close;
L3_1:
	mes "[執?アブ?イ]";
	mes "^ff0000?なたは、一期間に2回まで??することが出?ます。^000000";
	mes " ";
	mes "必要な??量は^ff0000 10,000 ^000000Zenyです";
	mes "??しますか？";
	next;
	menu "??する",L3_1_1,"??しない",-;
		mes "[執?アブ?イ]";
		mes "了解しました。";
		mes "急ぐ必要は無いですからね〜";
		close;
	L3_1_1:
		if(Zeny < 10000) goto L3_error;
		set Zeny,Zeny-10000;
		SetCastleData "prtg_cas01.gat",5,@TriggerD+1;
		SetCastleData "prtg_cas01.gat",3,@Deffence+10000;
		mes "[執?アブ?イ]";
		mes "??に成功しました。";
		close;
L3_error:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "??に必要なお金が?りません。";
	mes "??を取り消しました。";
	close;
//================================================
//Phase 4:ガーディア?設置
//================================================
L4:
	mes "[執?アブ?イ]";
	mes "ガーディア?を設置しますか？";
	mes "ガーディア?は敵からギ?ドベースを保護するでしょう。";
	mes "ガーディア?を選んでください。";
	next;
	menu "Soldier 1",L4_1,"Soldier 2",L4_2,"Soldier 3",L4_3,"Archer 1",L4_4,"Archer 2",L4_5,"Knight 1",L4_6,"Knight 2",L4_7,"Knight 3",L4_8;
		L4_1:
			if (GetCastleData("prtg_cas01.gat",10) == 1) goto L4Error2;
			set @GDnum,10;goto L4_9;
		L4_2:
			if (GetCastleData("prtg_cas01.gat",11) == 1) goto L4Error2;
			set @GDnum,11;goto L4_9;
		L4_3:
			if (GetCastleData("prtg_cas01.gat",12) == 1) goto L4Error2;
			set @GDnum,12;goto L4_9;
		L4_4:
			if (GetCastleData("prtg_cas01.gat",13) == 1) goto L4Error2;
			set @GDnum,13;goto L4_9;
		L4_5:
			if (GetCastleData("prtg_cas01.gat",14) == 1) goto L4Error2;
			set @GDnum,14;goto L4_9;
		L4_6:
			if (GetCastleData("prtg_cas01.gat",15) == 1) goto L4Error2;
			set @GDnum,15;goto L4_9;
		L4_7:
			if (GetCastleData("prtg_cas01.gat",16) == 1) goto L4Error2;
			set @GDnum,16;goto L4_9;
		L4_8:
			if (GetCastleData("prtg_cas01.gat",17) == 1) goto L4Error2;
			set @GDnum,17;goto L4_9;
	L4_9:
		mes "[執?アブ?イ]";
		mes "本?に設置しますか？";
		mes "ガーディア?の設置には^ff0000 10,000 ^000000Zenyが必要です。";
		next;
		menu "設置する",L4_9_1,"やめる",-;
			mes "[執?アブ?イ]";
			mes "了解しました。";
			mes "急ぐ必要は無いですからね〜";
			close;
		L4_9_1:
//ギ?ドスキ?の判定→ダ?ならL4Error
		if (Zeny < 10000) goto L4Error3;
		set Zeny,Zeny-10000;
		setcastledata "prtg_cas01.gat",@GDnum,1;
		mes "[執?アブ?イ]";
		mes "ガーディア?が設置されました。";
		mes "ガーディア?は?達の城を敵から守ってくれるでしょう。";
		close;
L4Error:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "ガーディア?を設置するギ?ドスキ?が?りません。ガーディア?を設置するスキ?を獲得したければ、＾ff0000ガーディア?スキ?＾000000を得なければなりません。";
	mes " ";
	mes "ガーディア?設置が取り消されました。";
	close;
L4Error2:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "既にガーディア?が設置されています。";
	mes " ";
	mes "ガーディア?設置が取り消されました。";
	close;
L4Error3:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "??に必要なお金が?りません。";
	mes "??を取り消しました。";
	close;
//================================================
//Phase 5:カプ?との契約・解雇
//================================================
L5:
	if (GetCastleData("prtg_cas01.gat",9) == 1) goto Lkafra_dimi;
//=========================
//(When Karfa off) Employment
//=========================
	mes "[執?アブ?イ]";
	mes "カプ?との契約を?びますか？";
	mes "契約には^ff0000 10000 ^000000Zeny 必要です";
	next;
	menu "契約する",-,"キ??セ?",L_k_E;
//debag
	goto L_k_0;
//check Kafraskill(OK -> L_k_0,NG -> -)
		mes "[執?アブ?イ]";
		mes "マスター！どうやらスキ?が足りないようです。カプ?と契約するには ^ff0000KAFRA SKILL^000000 が必要です。";
		close;
	L_k_0:
		if (Zeny > 10000) goto L_k_1;
		mes "[執?アブ?イ]";
		mes "マスター！お金が足りませんよ！";
		close;
	L_k_1:
		set Zeny,Zeny-10000;
		enablenpc "kapra_prtg01";
		setcastledata "prtg_cas01.gat",9,1;
		mes "[執?アブ?イ]";
		mes "カプ?との契約が完了しました";
		next;
		cutin "kafra_01",2;
		mes "[カプ?職員]";
		mes "?めまして、カプ?ディフォ?テと申します。";
		mes "最善を尽くしますので宜しくおねがいします！";
		next;
		cutin "kafra_01",255;
		mes "[執?アブ?イ]";
		mes "ギ?ドベースでカプ?との契約を維?するために";
		mes "??Zenyを払わなければなりません。";
		close;
L_k_e:
		mes "[執?アブ?イ]";
		mes "イエッサー！";
		mes "でも、そろそろカプ?がほしいですね。";
		close;
//=========================
//(When karfa ON) Dismissal
//=========================
Lkafra_dimi:
	mes "[執?アブ?イ]";
	mes "カプ?職員との契約を破棄しますか？";
	next;
	menu "解雇する",-,"キ??セ?",L_D_1;
		cutin "kafra_01",2;
		mes "[カプ?職員]";
		mes "?が何か間違っていましたか？そうならば、?してはもらえませんか…";
		next;
		menu "解雇する",-,"キ??セ?",L_D_2;
				mes "[カプ?職員]";
				mes "??、解雇なさるんですね、、、TT";
				next;
				disablenpc "kapra_prtg01";
				setcastledata "prtg_cas01.gat",9,0;
				cutin "kafra_01",255;
				mes "[執?アブ?イ]";
				mes "....";
				mes "カプ?との契約が破棄されました。";
				close;
			L_D_2:
				mes "[カプ?職員]";
				mes "?りがとうございます。全力を尽くして執務につきます！";
				cutin "kafra_01",255;
				close;
		L_D_1:
			mes "[執?アブ?イ]";
			mes "わかりました。";
			close;
L5_1:
//================================================
//Phase 6:マスター?ー?に行く
//================================================
L6:
	mes "[執?アブ?イ]";
	mes "マスター?ー?へいきますか？";
	mes "マスター?ー?に入れるのはギ?ドマスターだけです。つまり、入れるのは?なた一人だけということです。";
	next;
	menu "マスター?ー?に入る",-,"キ??セ?",L6_1;
			mes "[執?アブ?イ]";
			mes "では、?の後についてきてください。";
			mes "?屋から出るときは、?バーを引いてくださいね";
			next;
			warp "prtg_cas01",15,209;
		L6_1:
			mes "[執?アブ?イ]";
			mes "品物は常に生産されています。出?る限り?日取りに行ってください。";
			mes "そのうちに品物をすべて得ることを怠らないでください。";
			close;
//================================================
//Phase 7: アジト放棄
//================================================
L7:
	mes "[執?アブ?イ]";
	mes "マスター！";
	mes "アジトを放棄するんですか！？";
	mes " ";
	mes "どうか考え直してください、マスター！";
	next;
	menu "アジトを放棄する",L7_1,"キ??セ?",L7_2;
		L7_1:
			mes "[執?アブ?イ]";
			mes "マスター！";
			mes "どうかもう一度考え直してください…T_T!!";
			mes "どうか、、お願い!!!!!!!!";
			next;
			menu "やめる",L7_2,"アジトを放棄する",-;
				mes "[執?アブ?イ]";
				mes "マスター!!…";
				mes "…い……やだ……?……";
				next;
		setcastledata "prtg_cas01.gat",1,0;
		setcastledata "prtg_cas01.gat",2,0;
		setcastledata "prtg_cas01.gat",3,0;
		setcastledata "prtg_cas01.gat",4,0;
		setcastledata "prtg_cas01.gat",5,0;
		setcastledata "prtg_cas01.gat",6,0;
		setcastledata "prtg_cas01.gat",7,0;
		setcastledata "prtg_cas01.gat",8,0;
		setcastledata "prtg_cas01.gat",9,0;
		setcastledata "prtg_cas01.gat",10,0;
		setcastledata "prtg_cas01.gat",11,0;
		setcastledata "prtg_cas01.gat",12,0;
		setcastledata "prtg_cas01.gat",13,0;
		setcastledata "prtg_cas01.gat",14,0;
		setcastledata "prtg_cas01.gat",15,0;
		setcastledata "prtg_cas01.gat",16,0;
		setcastledata "prtg_cas01.gat",17,0;
		disablenpc "kapra_prtg01";
		Announce "砦 [" + GetCastleName("prtg_cas01.gat") + "]を [" + GetGuildName(@GIDp1) + "]ギ?ドが破棄しました。",0;
		MapRespawnGuildID "prtg_cas01.gat",GetCastleData("prtg_cas01.gat",1),7;
		end;
		L7_2:
			mes "[執?アブ?イ]";
			mes "イエッサー！マスター^^!";
			mes "もう、そんな冗談よしてくださいよ^^.";
			close;
}

prontera.gat,151,187,4	script	テストギ?ドフ?ッグ	722,{
	set @GIDp1,getcastledata("prtg_cas01.gat",1);
	if (@GIDp1 != 0) goto LStartg;
		mes "[ ?ー?ミッドガッツ王?領 ]";
		mes " ";
		mes "1.";
		mes "こちらは?ー?ミッドガッツ王?に";
		mes "よって";
		mes "正式?有者がないアジトで?ることを";
		mes "公表する。";
		next;
		mes " ";
		mes "2.";
		mes "こちらを守っている凄じい";
		mes "?練に?って、エ?ペ?ウ?を";
		mes "破壊する勇者には?王が";
		mes "認定するアジト?有?が?与される";
		close;
LStartg:
		if (getcharid(2) == @GIDp1) goto LStartg2;
		mes "[ ?ー?ミッドガッツ王?領 ]";
		mes " ";
		mes "1.";
		mes "こちらは?ー?ミッドガッツ王?に";
		mes "よって";
		mes "ギ?ド ^ff0000 " + GetGuildName(@GIDp1) + " ^000000の";
		mes "?有で?ることを認められている。";
		next;
		mes " ";
		mes "2.";
		mes "^ff0000 " + GetGuildName(@GIDp1) + " ^000000 のマスターは";
		mes "^ff0000 " + getguildmaster(@GIDp1) + " ^000000で?る。";
		mes "これに異議の?る者は、?を取り";
		mes "力を以って名誉を?ち取りなさい。"; 
		close;
LStartg2:
		mes "[ ?ー?ミッドガッツ王?領 ]";
		mes "ギ?ドアジトに戻ります";
		next;
		warp "prtg_cas01.gat",97,174;end;
OnRecvCastleP01:
// [FlagEmblem GuildID]: Show EMBLEM of the GuildID to the FlagNPC(ClassID=722).
	FlagEmblem getcastledata("prtg_cas01.gat",1);
	end;
}

//ギ?ド宝?(暫定)
prtg_cas01.gat,10,209,0 script t_box_p1s -1,{
OnClock0000:
	killmonster "prtg_cas01.gat","t_box_p1";
	if (getcastledata("prtg_cas01.gat",1) == 0) end;
	set $boxnum,2+getcastledata("prtg_cas01.gat",2)/100000;
	areamonster "prtg_cas01.gat",6,204,15,213,"宝?",1324,$boxnum,"t_box_p1";
	areamonster "prtg_cas01.gat",6,204,15,213,"宝?",1325,$boxnum,"t_box_p1";
	end;
}

